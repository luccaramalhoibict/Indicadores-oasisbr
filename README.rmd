---
title: "Documentação app indicadores oasisbr"
output:
  html_document: default
  pdf_document: default
---
## Indicadores gerais oasisbr

Os indicadores da oasisbr são disponibilizados via api.

```{r}
oasisbrAPILink <- "https://oasisbr.ibict.br/vufind/api/v1/search?&type=AllFields&page=0&limit=0&sort=relevance&facet[]=author_facet&facet[]=dc.subject.por.fl_str_mv&facet[]=eu_rights_str_mv&facet[]=dc.publisher.program.fl_str_mv&facet[]=dc.subject.cnpq.fl_str_mv&facet[]=publishDate&facet[]=language&facet[]=format&facet[]=institution&facet[]=dc.contributor.advisor1.fl_str_mv"
```

É feito o download do arquivo em formato ```JSON``` via pacote ```jsolinte```, utilizando-se a função ```fromJSON```.

```{r}
library(jsonlite)
oasisbrDF <- fromJSON(oasisbrAPILink)
```
***
O arquivo possui a seguinte estrutura:
```{r, echo=TRUE}
names(oasisbrDF)
```

***
Dentro da lista `resultCount`, encontra-se **quantidade de documentos** recuperados:

```{r, echo=TRUE}
oasisbrDF$resultCount
```
***
Dentro da lista `facets`, encontram-se **dez listas para dez variáveis diferentes**:


```{r, echo=TRUE}
names(oasisbrDF$facets)
```

Todas as listas possuem **4 colunas** (exemplo: `author_facet`):
```{r, echo=TRUE}
names(oasisbrDF$facets$author_facet)
```

A coluna `value` representa o valor, `translated` o valor traduzido, `count` a frequência e `href` o hyperlink.

```{r, echo=TRUE}
head(oasisbrDF$facets$author_facet)
```

***
Dentro da lista `status`, é exiba uma mensagem sobre o **status** do `JSON`.


```{r, echo=TRUE}
oasisbrDF$status
```

********
# Visualização dos indicadores
## Autor `author_facet`


```{r, echo=TRUE, message=FALSE,warning=FALSE}
library(ggplot2)
library(scales)
library(plotly)

author_facet <- oasisbrDF$facets$author_facet

## Ordena coluna 'count'
author_facet <- author_facet[with(author_facet, order(-count)),]

## Retira registro 'sem informação' da coluna 'value'
author_facet <- author_facet[author_facet$value!='sem informação',]

## Seleciona top 10
author_facet <- head(author_facet, n=10)

## Gráfico de top 10 Autore(a)s

authorPlot <- ggplot(author_facet) +
  aes(x = reorder(value, count), group = value, weight = count, 
      text=paste("Autor(a):",value,"<br>","Quantidade",comma(count))) +
  geom_bar(fill = "#112446") +
  labs(x = "Nome do autor(a)", 
       y = "Total de documentos", title = NULL) +
  theme_minimal() +
  theme(axis.title.x = element_text(size = 14L)) +
  coord_flip()

ggplotly(authorPlot, tooltip="text")

```
